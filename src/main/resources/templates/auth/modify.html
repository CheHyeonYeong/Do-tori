<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>ğŸŒ° Do-Tori</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/favicon.ico}" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{/css/styles.css}" rel="stylesheet" />
    <link th:href="@{/css/aside.css}" rel="stylesheet" />
    <link th:href="@{/css/auth_modify.css}" rel="stylesheet" />
    <script th:src="@{/js/auth_info.js}"></script>


</head>

<div layout:fragment="content" class="content_layout">

    <aside class="aside">
        <div class="auth">
            <span class="aside_menu_film"></span>
            <div class="icon_box">
                <svg width="31" height="31" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="28" cy="27.5" r="27" stroke="black"></circle>
                    <circle cx="27.5" cy="19" r="6.5" stroke="black"></circle>
                    <path d="M28.5 54.5H28.4738L28.4477 54.5027C23.8368 54.9881 19.3154 53.4102 15.9207 51.6202C14.2281 50.7277 12.8296 49.7899 11.8582 49.048C11.3719 48.6765 10.9976 48.358 10.7493 48.1226C10.6338 48.013 10.5521 47.9276 10.5005 47.8673C10.5723 37.9577 18.6776 29.5 28 29.5C37.3258 29.5 45.4337 37.964 45.4996 47.8784C45.4589 47.9289 45.395 48.0001 45.3039 48.0916C45.097 48.2993 44.7809 48.581 44.3617 48.9125C43.5249 49.5743 42.2992 50.4177 40.7624 51.2475C37.6863 52.9086 33.3934 54.5 28.5 54.5Z" stroke="black"></path>
                </svg>
                <form action="/auth/info" method="post">
                    <button type="submit" class="auth_aside_txt info">[[${#authentication.principal.nickName}]]</button>
                </form>
            </div>
        </div>

        <div class="auth_modify">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25">
                <g id="_01_align_center" data-name="01 align center">
                    <path d="M22.94,1.06a3.626,3.626,0,0,0-5.124,0L0,18.876V24H5.124L22.94,6.184A3.627,3.627,0,0,0,22.94,1.06ZM4.3,22H2V19.7L15.31,6.4l2.3,2.3ZM21.526,4.77,19.019,7.277l-2.295-2.3L19.23,2.474a1.624,1.624,0,0,1,2.3,2.3Z"/>
                </g>
            </svg>
            <span class="auth_aside_txt">
                íšŒì› ì •ë³´ ìˆ˜ì •
            </span>
        </div>

        <div class="auth_toriBox">
            <span class="aside_menu_film"></span>
            <img th:src="@{/assets/auth_like.png}" style="width: 25px">
            <a th:href="@{/post/likes}" class="text-decoration-none auth_aside_txt">
                ë§ˆìŒí•¨
            </a>
        </div>

        <div class="auth_logout">
            <span class="aside_menu_film"></span>
            <svg width="25" height="25" viewBox="0 0 364 352" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M342.412 0H299.61C293.934 0 288.491 2.31566 284.477 6.43755C280.464 10.5594 278.209 16.1499 278.209 21.9792C278.209 27.8084 280.464 33.3989 284.477 37.5208C288.491 41.6427 293.934 43.9583 299.61 43.9583H321.011V307.708H299.61C293.934 307.708 288.491 310.024 284.477 314.146C280.464 318.268 278.209 323.858 278.209 329.687C278.209 335.517 280.464 341.107 284.477 345.229C288.491 349.351 293.934 351.667 299.61 351.667H342.412C348.087 351.667 353.531 349.351 357.544 345.229C361.558 341.107 363.812 335.517 363.812 329.687V21.9792C363.812 16.1499 361.558 10.5594 357.544 6.43755C353.531 2.31566 348.087 0 342.412 0Z" fill="black"/>
                <path d="M188.327 74.7293C184.921 70.0659 179.851 66.9829 174.233 66.1585C168.614 65.3341 162.906 66.8359 158.366 70.3334C153.825 73.831 150.823 79.0378 150.02 84.8084C149.218 90.5791 150.68 96.4409 154.085 101.104L192.607 153.854H21.4008C15.7249 153.854 10.2816 156.17 6.26814 160.292C2.25472 164.414 0 170.004 0 175.833C0 181.663 2.25472 187.253 6.26814 191.375C10.2816 195.497 15.7249 197.813 21.4008 197.813H192.607H194.533L157.724 251.442C156.081 253.804 154.911 256.477 154.28 259.306C153.649 262.136 153.57 265.066 154.048 267.926C154.525 270.787 155.55 273.523 157.062 275.975C158.575 278.427 160.545 280.547 162.86 282.213C166.498 284.821 170.835 286.203 175.272 286.169C178.667 286.153 182.01 285.307 185.024 283.702C188.039 282.097 190.638 279.778 192.607 276.938L252.957 189.021C255.635 185.257 257.079 180.715 257.079 176.053C257.079 171.391 255.635 166.85 252.957 163.085L188.327 74.7293Z" fill="black"/>
            </svg>
            <form action="/auth/logout" method="post">
                <button type="submit" class="auth_aside_txt logout">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </form>
        </div>
    </aside>

    <div class="toggle-btn">
        <div class="trigger">
            <span></span><span></span><span></span>
        </div>
    </div>

    <div class="main_info">
        <div class="main_info_container">
            <h4 class="title">íšŒì› ì •ë³´ ìˆ˜ì •</h4>

            <form th:action="@{/auth/modify}" method="post" id="f1">
                <div class="mb">
                    <span class="input-group-txt">ì•„ì´ë””</span>
                    <input type="text" th:value="${#authentication.principal.id}" name="id" class="form-con" readonly>
                </div>

                <div class="mb">
                    <span class="input-group-txt">ë¹„ë°€ë²ˆí˜¸</span>
                    <input type="password" name="password" id="password" class="form-con">
                </div>

                <div class="mb">
                    <span class="input-group-txt">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</span>
                    <input type="password" id="passwordConfirm" class="form-con">
                </div>

                <div class="mb">
                    <span class="input-group-txt">ë‹‰ë„¤ì„</span>
                    <input type="text" th:value="${#authentication.principal.nickName}" name="nickName" id="nickName" class="form-con">
                </div>

                <div class="mb">
                    <span class="input-group-txt">ì´ë©”ì¼</span>
                    <input type="email" th:value="${#authentication.principal.email}" name="email" class="form-con" readonly>
                </div>

                <div class="btn_box">
                    <input type="button" value="ì·¨ì†Œ" class="btn btn-primary closeBtn">
                    <input type="submit" value="ìˆ˜ì •" class="btn btn-primary modifyBtn">
                    <input type="button" value="íƒˆí‡´" class="btn btn-danger removeBtn">
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>


<script layout:fragment="script" th:inline="javascript">
    const formObj = document.querySelector("#f1")

    document.querySelector(".removeBtn").addEventListener("click", function (e) {
        e.preventDefault()
        e.stopPropagation()

        formObj.action = `/auth/delete`
        formObj.method = 'post'
        formObj.submit()

        alert("íšŒì› íƒˆí‡´ ì™„ë£Œ. ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.")
    }, false)

    document.querySelector(".closeBtn").addEventListener("click", function (e) {
        e.preventDefault()
        e.stopPropagation()

        formObj.reset()
        self.location = `/auth/info`

    }, false)

    document.querySelector(".modifyBtn").addEventListener("click", function (e) {
        e.preventDefault()

        const passwordInput = document.getElementById('password');
        const passwordConfirmInput = document.getElementById('passwordConfirm');
        const password = passwordInput.value;
        const passwordConfirm = passwordConfirmInput.value;

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
        const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        if (!passwordRegex.test(password)) {
            alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•˜ë©°, ì˜ë¬¸ ëŒ€/ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            passwordInput.focus();
            return;
        }
        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ ê²€ì‚¬
        if (password !== passwordConfirm) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            passwordConfirmInput.focus();
            return;
        }

        const nicknameInput = document.getElementById('nickName');
        const nickname = nicknameInput.value;
        // ë‹‰ë„¤ì„ ìœ íš¨ì„± ê²€ì‚¬
        const nicknameRegex = /^.{1,4}$/;
        if (!nicknameRegex.test(nickname)) {
            alert("ë‹‰ë„¤ì„ì€ 4ê¸€ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.")
            nicknameInput.focus();
            return;
        }

        document.getElementById('f1').submit();

        alert("ì •ë³´ ìˆ˜ì • ì™„ë£Œ !")

    }, false)

</script>
</html>